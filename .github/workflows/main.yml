name: Pipeline CI/CD #DA CERTOO
on: 
  push:
    branches: [main]
    
    paths:
      - "src/**"
      - ".github/workflows/**"
      
  workflow_dispatch: # habilitar o botao "Run Worldflow" no github actions

jobs:
  Build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Chekout
        uses: actions/checkout@v5

      - name: Instalar node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: "npm"
          cache-dependency-path: package-lock.json
          
      - name: Instalar dependenciaas   
        run: npm install

      - name: Rodar build 
        run: npm run build
 
  Tests:
    runs-on: ubuntu-latest
    needs: Build
    
    steps:
      - name: Chekout
        uses: actions/checkout@v5

      - name: Instalar node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: "npm"
          cache-dependency-path: package-lock.json
          
      - name: Instalar dependenciaas   
        run: npm install

      - name: Rodar lint
        run: npm run lint

      - name: Verificar formatacao
        run: npm run format -- --check

      - name: Rodar tests
        run: npm run test
        
  Deploy:
    runs-on: ubuntu-latest
    needs: Tests
    
    steps:
      - name: Chekout
        uses: actions/checkout@v5

      - name: Instalar node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: "npm"
          cache-dependency-path: package-lock.json

      - name: Instalação Vercel CLI
        run: npm install -g vercel@latest

      - name: Deploy para Vercel
        run: vercel --prod --yes --token=${{secrets.VERCEL_TOKEN}}
